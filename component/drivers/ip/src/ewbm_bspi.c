/**
  ******************************************************************************
  * @file    ewbm_bspi.c
  * @author  eWBM
  * @version  0.1
  * @date    2016-07-08
  * @brief   BSPI Device driver
  ******************************************************************************
  * @attention
  *
  * Copyright(c) 2015 ~ 2020 eWBM Korea , Ltd.
  * All rights reserved.
  * This software contains confidential information of eWBM Korea Co.,Ltd.
  * and unauthorized distribution of this software, or any portion of it, are
  * prohibited.
  *
  * Brief history
  * -------------
  *  2016-07-08 : Draft by Leon Cho
  *
  ******************************************************************************
  */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "ewbm_bspi.h"
#include "ewbm_delay.h"
#include <string.h>

#define BSPI_BLOCK_SIZE                     (0x10000)     /*!< BSPI BLOCK SIZE : 64KB */
#define BSPI_SECTOR_SIZE                    (0x1000)      /*!< BSPI SECTOR SIZE : 4KB */
#define BSPI_DATA_ADDR                      (0x30000000)
#define BSPI_JEDEC_ID                       (0x00F84216)

/** @addtogroup EWBM_Peripheral
 * @{
 */

/** @addtogroup EWBM_BSPI
 * @{
 */

/** @defgroup BSPI_Internal_Types BSPI Intenal Types
 * @{
 */
 
/**
  * @brief  enumeration of bspi tmd mode
  */
typedef enum {
    BSPI_TMD_MODE_SINGLE    = 0x00,
    BSPI_TMD_MODE_DUAL      = 0x02,
    BSPI_TMD_MODE_QUAD      = 0x03
} eBSPI_TMD;

/**
  * @brief  enumeration of bspi status
  */
typedef enum {
    BSPI_BUSY       = (1<<0),   /*!< Erase or Wrte in Progess */
    BSPI_WEL        = (1<<1),   /*!< Write Enable Latch */
    BSPI_BP0        = (1<<2),   /*!< Block Protect ( Non-Volatile ) */
    BSPI_BP1        = (1<<3),   /*!< Block Protect ( Non-Volatile ) */
    BSPI_BP2        = (1<<4),   /*!< Block Protect ( Non-Volatile ) */
    BSPI_TB         = (1<<5),   /*!< Top/Bottom Write Protect */
    BSPI_SEC        = (1<<6),   /*!< Sector Protect ( Non-Volatile ) */
    BSPI_SRP0       = (1<<7),   /*!< Status Register Protect 0 ( Non-Volatile ) */
    BSPI_SRP1       = (1<<8),   /*!< Status Register Protect 1 ( Non-Volatile ) */
    BSPI_QE         = (1<<9),   /*!< Quad Enable ( Non-Volatile ) */
    BSPI_RESERVE0   = (1<<10),  /*!< Reserved  */
    BSPI_RESERVE1   = (1<<11),  /*!< Reserved */
    BSPI_RESERVE2   = (1<<12),  /*!< Reserved */
    BSPI_RESERVE3   = (1<<13),  /*!< Reserved */
    BSPI_CMP        = (1<<14),  /*!< Complement Protect ( Non-Volatile ) */
    BSPI_SUS        = (1<<15)   /*!< Suspend Status */
} eBSPI_STATUS;

#ifdef __QSPIBOOT__
static const volatile uint8_t instSetData[2164] = {
    0x7F, 0x45, 0x4C, 0x46, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x28, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x06, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x05, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00,
    0x0F, 0x00, 0x0C, 0x00, 0x80, 0xB5, 0x82, 0xB0, 0x00, 0xAF, 0xC4, 0x23,
    0x9B, 0x05, 0x7B, 0x60, 0x7B, 0x68, 0x08, 0x22, 0xDA, 0x61, 0x7B, 0x68,
    0x01, 0x22, 0xDA, 0x61, 0xC0, 0x46, 0x7B, 0x68, 0x5B, 0x69, 0x01, 0x22,
    0x13, 0x40, 0xFA, 0xD1, 0x01, 0x23, 0x18, 0x00, 0xBD, 0x46, 0x02, 0xB0,
    0x80, 0xBD, 0xC0, 0x46, 0x80, 0xB5, 0x84, 0xB0, 0x00, 0xAF, 0x78, 0x60,
    0xC4, 0x23, 0x9B, 0x05, 0xFB, 0x60, 0xFB, 0x68, 0x08, 0x22, 0xDA, 0x61,
    0x7B, 0x68, 0xC0, 0x22, 0x92, 0x01, 0x94, 0x46, 0x63, 0x44, 0x1A, 0x04,
    0xFB, 0x68, 0x5A, 0x62, 0xC0, 0x46, 0xFB, 0x68, 0x5B, 0x69, 0x01, 0x22,
    0x13, 0x40, 0xFA, 0xD1, 0x01, 0x23, 0x18, 0x00, 0xBD, 0x46, 0x04, 0xB0,
    0x80, 0xBD, 0xC0, 0x46, 0x80, 0xB5, 0x84, 0xB0, 0x00, 0xAF, 0x78, 0x60,
    0xC4, 0x23, 0x9B, 0x05, 0xFB, 0x60, 0xFB, 0x68, 0x08, 0x22, 0xDA, 0x61,
    0x7B, 0x68, 0xC0, 0x22, 0x92, 0x02, 0x94, 0x46, 0x63, 0x44, 0x1A, 0x03,
    0xFB, 0x68, 0x1A, 0x62, 0xC0, 0x46, 0xFB, 0x68, 0x5B, 0x69, 0x01, 0x22,
    0x13, 0x40, 0xFA, 0xD1, 0x01, 0x23, 0x18, 0x00, 0xBD, 0x46, 0x04, 0xB0,
    0x80, 0xBD, 0xC0, 0x46, 0x80, 0xB5, 0x86, 0xB0, 0x00, 0xAF, 0xF8, 0x60,
    0xB9, 0x60, 0x7A, 0x60, 0xFB, 0x68, 0x3B, 0x61, 0x00, 0x23, 0x7B, 0x61,
    0x0B, 0xE0, 0x7B, 0x69, 0xBA, 0x68, 0xD3, 0x18, 0x7A, 0x69, 0x39, 0x69,
    0x8A, 0x18, 0x12, 0x78, 0xD2, 0xB2, 0x1A, 0x70, 0x7B, 0x69, 0x01, 0x33,
    0x7B, 0x61, 0x7A, 0x69, 0x7B, 0x68, 0x9A, 0x42, 0xEF, 0xDB, 0x7B, 0x68,
    0x18, 0x00, 0xBD, 0x46, 0x06, 0xB0, 0x80, 0xBD, 0x80, 0xB5, 0x8C, 0xB0,
    0x00, 0xAF, 0xF8, 0x60, 0xB9, 0x60, 0x7A, 0x60, 0xC4, 0x23, 0x9B, 0x05,
    0xBB, 0x62, 0x00, 0x23, 0xFB, 0x62, 0x00, 0x23, 0x7B, 0x62, 0xFB, 0x68,
    0x3B, 0x62, 0xFB, 0x68, 0xFB, 0x61, 0xBB, 0x68, 0xBB, 0x61, 0xBB, 0x68,
    0x7B, 0x61, 0x7B, 0x68, 0x9B, 0x10, 0x7B, 0x62, 0x00, 0x23, 0xFB, 0x62,
    0x15, 0xE0, 0xBB, 0x6A, 0x08, 0x22, 0xDA, 0x61, 0xFB, 0x6A, 0x9B, 0x00,
    0x3A, 0x6A, 0xD3, 0x18, 0xFA, 0x6A, 0x92, 0x00, 0xB9, 0x69, 0x8A, 0x18,
    0x12, 0x68, 0x1A, 0x60, 0xC0, 0x46, 0xBB, 0x6A, 0x5B, 0x69, 0x01, 0x22,
    0x13, 0x40, 0xFA, 0xD1, 0xFB, 0x6A, 0x01, 0x33, 0xFB, 0x62, 0xFA, 0x6A,
    0x7B, 0x6A, 0x9A, 0x42, 0xE5, 0xDB, 0x7B, 0x68, 0x03, 0x22, 0x13, 0x40,
    0x28, 0xD0, 0xFB, 0x6A, 0x9B, 0x00, 0x1A, 0x00, 0xFB, 0x69, 0x9B, 0x18,
    0xFB, 0x61, 0xFB, 0x6A, 0x9B, 0x00, 0x1A, 0x00, 0x7B, 0x69, 0x9B, 0x18,
    0x7B, 0x61, 0x00, 0x23, 0xFB, 0x62, 0x13, 0xE0, 0xBB, 0x6A, 0x08, 0x22,
    0xDA, 0x61, 0xFB, 0x6A, 0xFA, 0x69, 0xD3, 0x18, 0xFA, 0x6A, 0x79, 0x69,
    0x8A, 0x18, 0x12, 0x78, 0x1A, 0x70, 0xC0, 0x46, 0xBB, 0x6A, 0x5B, 0x69,
    0x01, 0x22, 0x13, 0x40, 0xFA, 0xD1, 0xFB, 0x6A, 0x01, 0x33, 0xFB, 0x62,
    0x7B, 0x68, 0x03, 0x22, 0x1A, 0x40, 0xFB, 0x6A, 0x9A, 0x42, 0xE5, 0xDC,
    0x7B, 0x68, 0x18, 0x00, 0xBD, 0x46, 0x0C, 0xB0, 0x80, 0xBD, 0xC0, 0x46,
    0x80, 0xB5, 0x86, 0xB0, 0x00, 0xAF, 0x02, 0x00, 0xFB, 0x1D, 0x1A, 0x70,
    0xC4, 0x23, 0x9B, 0x05, 0xFB, 0x60, 0x01, 0x23, 0x7B, 0x61, 0x13, 0x23,
    0xFB, 0x18, 0x00, 0x22, 0x1A, 0x70, 0xFB, 0x68, 0x1B, 0x69, 0x1B, 0x4A,
    0x93, 0x42, 0x01, 0xD0, 0x00, 0x23, 0x7B, 0x61, 0xFB, 0x68, 0x08, 0x22,
    0xDA, 0x61, 0xFB, 0x68, 0x00, 0x22, 0x5A, 0x61, 0xFB, 0x1D, 0x1B, 0x78,
    0x01, 0x2B, 0x07, 0xD1, 0xFB, 0x68, 0x02, 0x22, 0x9A, 0x61, 0x13, 0x23,
    0xFB, 0x18, 0x03, 0x22, 0x1A, 0x70, 0x0A, 0xE0, 0xFB, 0x68, 0x9B, 0x69,
    0x02, 0x22, 0x93, 0x43, 0x1A, 0x00, 0xFB, 0x68, 0x9A, 0x61, 0x13, 0x23,
    0xFB, 0x18, 0x00, 0x22, 0x1A, 0x70, 0x13, 0x23, 0xFB, 0x18, 0x1B, 0x78,
    0xC0, 0x22, 0x92, 0x01, 0x13, 0x43, 0x1A, 0x00, 0xFB, 0x68, 0x9A, 0x60,
    0xC0, 0x46, 0xFB, 0x68, 0x5B, 0x69, 0x01, 0x22, 0x13, 0x40, 0xFA, 0xD1,
    0x7B, 0x69, 0x18, 0x00, 0xBD, 0x46, 0x06, 0xB0, 0x80, 0xBD, 0xC0, 0x46,
    0x16, 0x42, 0xF8, 0x00, 0x00, 0x47, 0x43, 0x43, 0x3A, 0x20, 0x28, 0x47,
    0x4E, 0x55, 0x20, 0x54, 0x6F, 0x6F, 0x6C, 0x73, 0x20, 0x66, 0x6F, 0x72,
    0x20, 0x41, 0x52, 0x4D, 0x20, 0x45, 0x6D, 0x62, 0x65, 0x64, 0x64, 0x65,
    0x64, 0x20, 0x50, 0x72, 0x6F, 0x63, 0x65, 0x73, 0x73, 0x6F, 0x72, 0x73,
    0x29, 0x20, 0x35, 0x2E, 0x33, 0x2E, 0x31, 0x20, 0x32, 0x30, 0x31, 0x36,
    0x30, 0x33, 0x30, 0x37, 0x20, 0x28, 0x72, 0x65, 0x6C, 0x65, 0x61, 0x73,
    0x65, 0x29, 0x20, 0x5B, 0x41, 0x52, 0x4D, 0x2F, 0x65, 0x6D, 0x62, 0x65,
    0x64, 0x64, 0x65, 0x64, 0x2D, 0x35, 0x2D, 0x62, 0x72, 0x61, 0x6E, 0x63,
    0x68, 0x20, 0x72, 0x65, 0x76, 0x69, 0x73, 0x69, 0x6F, 0x6E, 0x20, 0x32,
    0x33, 0x34, 0x35, 0x38, 0x39, 0x5D, 0x00, 0x41, 0x30, 0x00, 0x00, 0x00,
    0x61, 0x65, 0x61, 0x62, 0x69, 0x00, 0x01, 0x26, 0x00, 0x00, 0x00, 0x05,
    0x43, 0x6F, 0x72, 0x74, 0x65, 0x78, 0x2D, 0x4D, 0x30, 0x00, 0x06, 0x0C,
    0x07, 0x4D, 0x09, 0x01, 0x12, 0x04, 0x14, 0x01, 0x15, 0x01, 0x17, 0x03,
    0x18, 0x01, 0x19, 0x01, 0x1A, 0x01, 0x1E, 0x06, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x04, 0x00, 0xF1, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x02, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x04, 0x00, 0x12, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x00, 0x05, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x06, 0x00,
    0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x07, 0x00, 0x12, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x00, 0x08, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x09, 0x00,
    0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x09, 0x00, 0x15, 0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x0A, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x00, 0x0B, 0x00, 0x18, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x2E, 0x00, 0x00, 0x00, 0x12, 0x00, 0x04, 0x00, 0x2C, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x3A, 0x00, 0x00, 0x00, 0x12, 0x00, 0x05, 0x00,
    0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x3A, 0x00, 0x00, 0x00,
    0x12, 0x00, 0x06, 0x00, 0x57, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x40, 0x00, 0x00, 0x00, 0x12, 0x00, 0x07, 0x00, 0x66, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0xCE, 0x00, 0x00, 0x00, 0x12, 0x00, 0x08, 0x00,
    0x76, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x94, 0x00, 0x00, 0x00,
    0x12, 0x00, 0x09, 0x00, 0x00, 0x65, 0x77, 0x62, 0x6D, 0x5F, 0x62, 0x73,
    0x70, 0x69, 0x5F, 0x73, 0x72, 0x61, 0x6D, 0x2E, 0x63, 0x00, 0x24, 0x74,
    0x00, 0x24, 0x64, 0x00, 0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61,
    0x73, 0x68, 0x43, 0x68, 0x69, 0x70, 0x45, 0x72, 0x61, 0x73, 0x65, 0x00,
    0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x42, 0x6C,
    0x6F, 0x63, 0x6B, 0x45, 0x72, 0x61, 0x73, 0x65, 0x00, 0x42, 0x53, 0x50,
    0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x53, 0x65, 0x63, 0x74, 0x6F,
    0x72, 0x45, 0x72, 0x61, 0x73, 0x65, 0x00, 0x42, 0x53, 0x50, 0x49, 0x5F,
    0x46, 0x6C, 0x61, 0x73, 0x68, 0x52, 0x65, 0x61, 0x64, 0x00, 0x42, 0x53,
    0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x57, 0x72, 0x69, 0x74,
    0x65, 0x00, 0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68,
    0x49, 0x6E, 0x69, 0x74, 0x00, 0x00, 0x2E, 0x73, 0x79, 0x6D, 0x74, 0x61,
    0x62, 0x00, 0x2E, 0x73, 0x74, 0x72, 0x74, 0x61, 0x62, 0x00, 0x2E, 0x73,
    0x68, 0x73, 0x74, 0x72, 0x74, 0x61, 0x62, 0x00, 0x2E, 0x74, 0x65, 0x78,
    0x74, 0x00, 0x2E, 0x64, 0x61, 0x74, 0x61, 0x00, 0x2E, 0x62, 0x73, 0x73,
    0x00, 0x2E, 0x74, 0x65, 0x78, 0x74, 0x2E, 0x42, 0x53, 0x50, 0x49, 0x5F,
    0x46, 0x6C, 0x61, 0x73, 0x68, 0x43, 0x68, 0x69, 0x70, 0x45, 0x72, 0x61,
    0x73, 0x65, 0x00, 0x2E, 0x74, 0x65, 0x78, 0x74, 0x2E, 0x42, 0x53, 0x50,
    0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x42, 0x6C, 0x6F, 0x63, 0x6B,
    0x45, 0x72, 0x61, 0x73, 0x65, 0x00, 0x2E, 0x74, 0x65, 0x78, 0x74, 0x2E,
    0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x53, 0x65,
    0x63, 0x74, 0x6F, 0x72, 0x45, 0x72, 0x61, 0x73, 0x65, 0x00, 0x2E, 0x74,
    0x65, 0x78, 0x74, 0x2E, 0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61,
    0x73, 0x68, 0x52, 0x65, 0x61, 0x64, 0x00, 0x2E, 0x74, 0x65, 0x78, 0x74,
    0x2E, 0x42, 0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x57,
    0x72, 0x69, 0x74, 0x65, 0x00, 0x2E, 0x74, 0x65, 0x78, 0x74, 0x2E, 0x42,
    0x53, 0x50, 0x49, 0x5F, 0x46, 0x6C, 0x61, 0x73, 0x68, 0x49, 0x6E, 0x69,
    0x74, 0x00, 0x2E, 0x63, 0x6F, 0x6D, 0x6D, 0x65, 0x6E, 0x74, 0x00, 0x2E,
    0x41, 0x52, 0x4D, 0x2E, 0x61, 0x74, 0x74, 0x72, 0x69, 0x62, 0x75, 0x74,
    0x65, 0x73, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1B, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x21, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x27, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
    0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x34, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x46, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x64, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x61, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA0, 0x00, 0x00, 0x00,
    0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7D, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xDC, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x92, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x1C, 0x01, 0x00, 0x00, 0xD0, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xA8, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEC, 0x01, 0x00, 0x00,
    0x94, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xBD, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x80, 0x02, 0x00, 0x00, 0x6F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0xC6, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xEF, 0x02, 0x00, 0x00, 0x31, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x45, 0x05, 0x00, 0x00,
    0xD6, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x20, 0x03, 0x00, 0x00, 0xA0, 0x01, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00,
    0x14, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
    0x09, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xC0, 0x04, 0x00, 0x00, 0x85, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00
};

typedef int (*_BSPI_FlashInit)(eBSPI_MODE);
typedef int (*_BSPI_FlashWrite)(uint32_t, const uint8_t*, int);
typedef int (*_BSPI_FlashRead)(uint32_t, uint8_t*, int);
typedef int (*_BSPI_FlashBlockErase)(uint32_t);
typedef int (*_BSPI_FlashSectorErase)(uint32_t);
typedef int (*_BSPI_FlashChipErase)(void);

#define BSPI_FlashInit_         ((_BSPI_FlashInit)(instSetData + 0x1ED))
#define BSPI_FlashWrite_        ((_BSPI_FlashWrite)(instSetData + 0x11D))
#define BSPI_FlashRead_         ((_BSPI_FlashRead)(instSetData + 0x0DD))
#define BSPI_FlashBlockErase_   ((_BSPI_FlashBlockErase)(instSetData + 0x065))
#define BSPI_FlashSectorErase_  ((_BSPI_FlashSectorErase)(instSetData + 0x0A1))
#define BSPI_FlashChipErase_    ((_BSPI_FlashChipErase)(instSetData + 0x035))

#endif

/**
  * @}
  */

/** @addtogroup BSPI_External_Func
  * @{
  */
#ifdef __QSPIBOOT__
/**
  * @brief  To initialize flash
  * @param  mode: single or quad mode
  * @retval if success, return 0.
  */
int BSPI_FlashInit(eBSPI_MODE mode)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashInit_(mode);
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

/**
  * @brief  write data to flash
  * @param  addr: address to write
  * @param  data: data to write
  * @param  size: size of data
  * @retval if success, return 0.
  */
int BSPI_FlashWrite(uint32_t addr, const uint8_t* data, int size)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashWrite_(addr, data, size);
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

/**
  * @brief  read data to flash
  * @param  addr: address to read
  * @param  data: pointer of data to read
  * @param  size: size of data
  * @retval if success, return 0.
  */
int BSPI_FlashRead(uint32_t addr, uint8_t* data, int size)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashRead_(addr, data, size);
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

/**
  * @brief  to erase block
  * @param  blknum: number of block
  * @retval if success, return 0.
  */
int BSPI_FlashBlockErase(uint32_t blknum)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashBlockErase_(blknum);
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

/**
  * @brief  to erase sector
  * @param  sctnum: number of sector
  * @retval if success, return 0.
  */
int BSPI_FlashSectorErase(uint32_t sctnum)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashSectorErase_(sctnum);
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

/**
  * @brief  to erase chip
  * @param  none
  * @retval if success, return 0.
  */
int BSPI_FlashChipErase(void)
{
    int ret;
    uint32_t cache_config = ICACHE->cache_config;
    uint32_t cache_ctrl   = ICACHE->cache_ctrl;

    ICACHE->cache_ctrl   = 0;
    ICACHE->cache_config = 0;

    __disable_irq();
    ret = BSPI_FlashChipErase_();
    __enable_irq();

    ICACHE->cache_config = cache_config;
    ICACHE->cache_ctrl   = cache_ctrl;

    return ret;
}

#else
/**
  * @brief  to erase chip
  * @param  none
  * @retval if success, return 0.
  */
int BSPI_FlashChipErase(void)
{
    tBSPI_REG* baseAddr = BSPI;

    baseAddr->m_1cmd = BSPI_M_1CMD_M_WREN;
    baseAddr->m_1cmd = BSPI_M_1CMD_M_CERASE;

    // BSPI Busy Check
    while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);

    return EWBMOK;
}

/**
  * @brief  to erase block
  * @param  blknum: number of block
  * @retval if success, return 0.
  */
int BSPI_FlashBlockErase(uint32_t blknum)
{
    tBSPI_REG* baseAddr = BSPI;

    baseAddr->m_1cmd   = BSPI_M_1CMD_M_WREN;
    baseAddr->m_berase = (BSPI_DATA_ADDR + (BSPI_BLOCK_SIZE*blknum));

    // BSPI Busy Check
    while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);

    return EWBMOK;
}

/**
  * @brief  to erase sector
  * @param  sctnum: number of sector
  * @retval if success, return 0.
  */
int BSPI_FlashSectorErase(uint32_t sctnum)
{
    tBSPI_REG* baseAddr = BSPI;

    baseAddr->m_1cmd   = BSPI_M_1CMD_M_WREN;
    baseAddr->m_serase = (BSPI_DATA_ADDR + (BSPI_SECTOR_SIZE*sctnum));

    // BSPI Busy Check
    while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);

    return EWBMOK;
}

/**
  * @brief  read data to flash
  * @param  addr: address to read
  * @param  data: pointer of data to read
  * @param  size: size of data
  * @retval if success, return 0.
  */
int BSPI_FlashRead(uint32_t addr, uint8_t* data, int size)
{
    volatile uint32_t* rdPhy = (volatile uint32_t*)addr;

    memcpy((void*)data, (void*)rdPhy, size);
    return size;
}

/**
  * @brief  write data to flash
  * @param  addr: address to write
  * @param  data: data to write
  * @param  size: size of data
  * @retval if success, return 0.
  */
int BSPI_FlashWrite(uint32_t addr, const uint8_t* data, int size)
{
    tBSPI_REG* baseAddr = BSPI;

    int i = 0;
    int dumySize = 0;

    volatile uint32_t* wreg = (volatile uint32_t*)addr;
    volatile uint8_t*  breg = (volatile uint8_t*)addr;
    uint32_t*          wdata = (uint32_t*)data;
    uint8_t*           bdata = (uint8_t*)data;

    dumySize = size >> 2;
    for ( i=0; i<dumySize; i++ )
    {
        baseAddr->m_1cmd = BSPI_M_1CMD_M_WREN;
        wreg[i] = wdata[i];

        // BSPI Busy Check
        while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);
    }

    if ( size & 3 )
    {
        breg  = breg + (i << 2);
        bdata = bdata + (i << 2);

        for ( i=0; i<(size&3); i++ )
        {
            baseAddr->m_1cmd = BSPI_M_1CMD_M_WREN;
            breg[i] = bdata[i];

            // BSPI Busy Check
            while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);
        }
    }

    return size;
}

/**
  * @brief  To initialize flash
  * @param  mode: single or quad mode
  * @retval if success, return 0.
  */
int BSPI_FlashInit(eBSPI_MODE mode)
{
    tBSPI_REG*  baseAddr = BSPI;
    int ret     = EWBMOK;
    uint8_t      tmdMode = 0;

    if ( baseAddr->m_jdec != BSPI_JEDEC_ID )
        ret = EWBMERR;

    baseAddr->m_1cmd = BSPI_M_1CMD_M_WREN;
    baseAddr->m_status = 0x0UL;

    if ( mode == BSPI_QUAD_MODE )
    {
        baseAddr->m_config = (0x01<<1);
        tmdMode = BSPI_TMD_MODE_QUAD;
    }
    else
    {
        baseAddr->m_config &= ~(0x01<<1);
        tmdMode = BSPI_TMD_MODE_SINGLE;
    }

    baseAddr->ctrl = BSPI_CTRL_P_WP | BSPI_CTRL_P_HOLD | tmdMode;

    // BSPI Busy Check
    while((baseAddr->m_status & BSPI_BUSY) & BSPI_BUSY);

    return ret;
}
#endif    //__QSPIBOOT__

/**
  * @}
  */

/**
  * @}
  */